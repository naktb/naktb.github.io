var ifConfig =

{
  "api": {
    "url": "http://api.naktb.com/index.php"
  },

  "messages": {
    "formFailed": " يوجد لديك خطاء فضلاً تأكد من المعلومات المدخلة وحاول مرةاخرى contact@naktb.com",
    "formSuccess": "! شكراً لتواصلك معنا. سوف يتصل بك خدمة العملاء في أقرب وقت ممكن لمساعدتك"
  },

  "callMeBackForm": {
    "defaults": {
      'Field1': '0000000000',
      'Field3': 'اسم'
    }
  },

  "orderForm": {
    "id": "q1qdx6e10trwg4z",
    "idStamp": "N0w2t6e+EH57yQSC/MkGC4S8Z6aoFaD3dXMnWJzQHns=",

    "controls": [
      {
        "title": "Academic Level",
        "name": "Field102",
        "type": "radio",
        "default": "",
        "required": true,
        "value": [
          "General",
          "Specialized"
        ]
      },

      {
        "title": "Type of Paper",
        "name": "Field115",
        "type": "select",
        "default": "",
        "required": true,
        "value": [
          "Creative writing",
          "Essay (any type)",
          "Research paper",
          "Presentation or speech",
          "Book/movie review",
          "Term paper",
          "Coursework",
          "Research proposal",
          "Dissertation",
          "Thesis",
          "Business plan",
          "Case study",
          "Admission essay",
          "Article review",
          "Annotated bibliography",
          "Argumentative essays",
          "Critical thinking",
          "Biographies",
          "Thesis/Dissertation abstract",
          "Dissertation chapter - Introduction",
          "Dissertation chapter - Literature review",
          "Dissertation chapter - Methodology",
          "Dissertation chapter - Results",
          "Dissertation chapter - Discussion",
          "Dissertation chapter - Conclusion",
          "Thesis/Dissertation proposal",
          "Thesis/Dissertation chapter",
          "Capstone project",
          "Other"
        ]
      },

      {
        "title": "Subject of Discipline",
        "name": "Field116",
        "type": "select",
        "default": "",
        "required": true,
        "value": [
          "Art (Fine arts, Performing arts)",
          "Classic English Literature",
          "Composition",
          "English 101",
          "Film & Theater studies",
          "History",
          "Linguistics",
          "Literature",
          "Music",
          "Philosophy",
          "Poetry",
          "Religious studies",
          "Shakespeare",
          "Anthropology",
          "Cultural and Ethnic Studies",
          "Economics",
          "Ethics",
          "Political science",
          "Psychology",
          "Social Work and Human Services",
          "Sociology",
          "Tourism",
          "Urban Studies",
          "Women's & gender studies",
          "Accounting",
          "Business Studies",
          "Finance",
          "Human Resources Management (HRM)",
          "International Relations",
          "Logistics",
          "Management",
          "Marketing",
          "Public Relations (PR)",
          "Astronomy (and other Space Sciences)",
          "Biology (and other Life Sciences)",
          "Chemistry",
          "Ecology",
          "Geography",
          "Geology (and other Earth Sciences)",
          "Physics",
          "Zoology",
          "Computer science",
          "Mathematics",
          "Statistics",
          "Agriculture",
          "Application Letters",
          "Architecture, Building and Planning",
          "Aviation",
          "Civil Engineering",
          "Communications",
          "Criminal Justice",
          "Criminal law",
          "Education",
          "Engineering",
          "Environmental studies and Forestry",
          "Family and consumer science",
          "Health Care",
          "International Trade",
          "IT, Web",
          "Law",
          "Leadership Studies",
          "Medical Sciences (Anatomy, Physiology, Pharmacology etc.)",
          "Medicine",
          "Nursing",
          "Nutrition/Dietary",
          "Public Administration",
          "Sports",
          "Technology",
          "Other (enter below)"
        ]
      },

      {
        "title": "Topic",
        "name": "Field105",
        "type": "text",
        "default": "sdsd",
        "required": false,
        "value": ""
      },

      {
        "title": "Paper Instructions",
        "name": "Field106",
        "type": "textarea",
        "default": "",
        "required": true,
        "value": ""
      },

      {
        "title": "Sources",
        "name": "Field107",
        "type": "number",
        "default": 0,
        "required": false,
        "value": ""
      },

      {
        "title": "Additional Materials",
        "name": "Field113",
        "type": "file",
        "default": "",
        "required": false,
        "value": ""
      },

      {
        "title": "Pages",
        "name": "Field108",
        "type": "number",
        "default": "",
        "required": true,
        "value": ""
      },

      {
        "title": "First Draft",
        "name": "Field109",
        "type": "radio",
        "default": "",
        "required": true,
        "value": [
          "3 days",
          "4 days",
          "6 days",
          "7 days",
          "10 days"
        ]
      },

      {
        "title": "Power Point Slides",
        "name": "Field111",
        "type": "number",
        "default": "",
        "required": false,
        "value": ""
      },

      {
        "title": "Progressive Delivery",
        "name": "Field111",
        "type": "checkbox",
        "default": false,
        "required": false,
        "value": "Progressive delivery"
      },

      {
        "title": "Email",
        "name": "Field110",
        "type": "email",
        "default": "",
        "required": true,
        "value": ""
      }
    ]
  }
};

if (typeof window === 'undefined')
  exports.ifConfig = ifConfig;

angular.module('naktbApp.main', []);
angular.module('naktbApp.services', []);
angular.module('naktbApp.helpers', []);
angular.module('naktbApp.directives', []);
angular.module('naktbApp.partials', []);

angular.module('naktbApp',
    [
      'ngRoute',
      'naktbApp.main',
      'naktbApp.services',
      'naktbApp.helpers',
      'naktbApp.directives',
      'naktbApp.partials'

    ])


    .config(["$routeProvider", "$locationProvider", function ($routeProvider, $locationProvider) {
      $routeProvider
          .when('/', {
            templateUrl: '/app/Home/_home.html',
            controller: 'HomeController',
            pageTitle: 'Welcome',
            page: 'homePage'
          })
          .when('/index.html', {
            templateUrl: '/app/Home/_home.html',
            controller: 'HomeController',
            pageTitle: 'Welcome',
            page: 'homePage'
          })
          .when('/service.html', {
            templateUrl: '/app/Service/_service.html',
            controller: 'ServiceController',
            pageTitle: 'Our Services',
            page: 'service'
          })
          .when('/price.html', {
            templateUrl: '/app/Price/_price.html',
            controller: 'PriceController',
            pageTitle: 'Prices',
            page: 'price'
          })
          .when('/contact.html', {
            templateUrl: '/app/Contact/_contact.html',
            controller: 'ContactController',
            pageTitle: 'Contact Us',
            page: 'contact'
          })
          .when('/who.html', {
            templateUrl: '/app/WhoWeAre/_whoWeAre.html',
            controller: 'WhoWeAreController',
            pageTitle: 'Who We Are',
            page: 'whoWeAre'
          })
          .when('/terms.html', {
            templateUrl: '/app/Terms/_terms.html',
            controller: 'TermsController',
            pageTitle: 'Terms of Use',
            page: 'terms'
          })
          .when('/return_policy.html', {
            templateUrl: '/app/ReturnPolicy/_returnPolicy.html',
            controller: 'ReturnPolicyController',
            pageTitle: 'Return Policy',
            page: 'returnPolicy'
          })
          .otherwise({
            templateUrl: '/app/Home/_home.html',
            controllerName: 'MainController',
            pageTitle: 'Welcome',
            page: 'homePage'
          });
      $locationProvider.html5Mode(true);
    }]);



angular.module('naktbApp.main').controller('MainController', ['$scope','$route', '$rootScope', '$routeParams', '$location', function ($scope, $route, $rootScope, $routeParams, $location) {
  //$scope.$route = $route;
  //$scope.$location = $location;
  //$scope.$routeParams = $routeParams;
  $scope.topMenuUrl = '/app/partials/topMenu.html';
  $scope.footerMenuUrl = '/app/partials/footerMenu.html';
  $rootScope.pageTitle = 'Welcome';

  $scope.$on('$routeChangeSuccess', function (next, current) {
    $rootScope.pageTitle = current.pageTitle;
  });

}]);

angular.module('naktbApp').controller('ContactController', ['$scope', '$rootScope', '$location', '$route', function($scope, $rootScope, $location, $route) {

  $rootScope.page = $route.current.page;

  $scope.formTemplateUrl = '/app/partials/orderForm.html';

}]);

angular.module('naktbApp').controller('HomeController', ['$scope', '$route', function($scope, $route) {

  $scope.formTemplateUrl = '/app/partials/callMeBackForm.html';

}]);

angular.module('naktbApp').controller('PriceController', ['$scope', '$rootScope', '$location', '$route', function($scope, $rootScope, $location, $route) {

  $rootScope.page = $route.current.page;
  $scope.formTemplateUrl = '/app/partials/callMeBackForm.html';

}]);

angular.module('naktbApp').controller('ReturnPolicyController', ['$scope', '$rootScope', '$location', '$route', function($scope, $rootScope, $location, $route) {

  $rootScope.page = $route.current.page;

}]);

angular.module('naktbApp').controller('ServiceController', ['$scope', '$rootScope', '$location', '$route', function($scope, $rootScope, $location, $route) {

  $rootScope.page = $route.current.page;


}]);

angular.module('naktbApp').controller('TermsController', ['$scope', '$rootScope', '$location', '$route', function($scope, $rootScope, $location, $route) {

  $rootScope.page = $route.current.page;

}]);

angular.module('naktbApp').controller('WhoWeAreController', ['$scope', '$rootScope', '$location', '$route', function($scope, $rootScope, $location, $route) {

  $rootScope.page = $route.current.page;

}]);

angular.module('naktbApp.directives')
    .directive('ngMenuHighlight', ["$rootScope", "$window", function($rootScope, $window) {
      return {
        restrict: 'A',
        link: function (scope, element, attr) {
          scope.$watch('page', function(){
            if (scope.menu.slug === $rootScope.page) {
              element.addClass('active');
            } else {
              element.removeClass('active');
            }
          })
        }
      }
    }]);

angular.module('naktbApp.services').factory('formHandler', ["$http", function($http){

  var sendForm = function (form, cb) {
    //$scope.spinner = true;
    //$scope.noResend = true;
    var apiUrl = ifConfig.api.url ? ifConfig.api.url : '/examples/index.php';
    var http = $http.post(apiUrl + '?functionName=submitForm&formName=' + form.name, form.data)
        .success(function (data, status, headers, config) {
          //$scope.spinner = false;
          cb(status);
        })
        .error(function (data, status, headers, config) {
          //$scope.spinner = false;
          //$scope.sendError = true;
          cb(status);
        });

    return http;
  };

  var formMessage = function ($scope, status) {
    var successMessage = ifConfig.messages.formSuccess ? ifConfig.messages.formSuccess : 'Form has been sent';
    var errorMessage = ifConfig.messages.formFailed ? ifConfig.messages.formFailed : 'Something gone wrong';

    if (status === 200) {
      $scope.formMessage = successMessage;
      $scope.formError = false;
    } else {
      $scope.formMessage = errorMessage;
      $scope.formError = true;
    }

    $scope.spinner = false;
    $scope.noResend = true;
  };

  var checkDefault = function ($form, inputName) {

    var defaults = ifConfig[$form.$name] ? ifConfig[$form.$name].defaults : {};

    if ($form[inputName].$viewValue == defaults[inputName]) {
      $form[inputName].$viewValue = '';
    }
  };

  var checkEntered = function ($form, inputName) {

    console.log($form);

    var defaults = ifConfig[$form.$name] ? ifConfig[$form.$name].defaults : {};

    if ($form[inputName].$viewValue == '') {
      $form[inputName].$viewValue = defaults[inputName];
    } else if ($form[inputName].$viewValue == defaults[inputName]) {
      $form[inputName].$viewValue = '';
    }
  };

  return {
    sendForm: sendForm,
    formMessage: formMessage,
    checkDefault: checkDefault,
    checkEntered: checkEntered
  }

}]);

angular.module('naktbApp.helpers').service('commonHelpers', function() {

  showLoader = function(show) {

  }

});

angular.module('naktbApp.partials')
    .controller('CallMeBackController', ['$scope', '$route', 'formHandler', function($scope, $route, formHandler) {

      $scope.spinner = false;
      $scope.phonePat = /^[0-9]+$/;
      $scope.formName = 'm1fj3yms1jn9uw1';
      $scope.callForm = {};
      $scope.callForm.idstamp = '9dEE38FnE/bKQEDjFp3OJfov8wcRTE2xjgD/QyJg8Wo=';
      $scope.callForm.comment = '';
      $scope.callForm.defaults = {
        'Field1': '0000000000',
        'Field3': 'اسم'
      };

      $scope.noResend = false;

      function formSentCb(status) {
        formHandler.formMessage($scope, status);
      }

      $scope.closeMessageBox = function() {
        $scope.formMessage = null;
      };


      $scope.checkForm = function () {
        $scope.spinner = true;
        console.log($scope.callMeBackForm);
        if (!$scope.noResend) {
          formHandler.sendForm({name:$scope.formName, data: $scope.callForm}, formSentCb);
        }
      };

      $scope.checkDefaults = function (inputName) {
        formHandler.checkDefault(this.callMeBackForm, inputName);
      };

      $scope.checkEntered = function (inputName) {
        formHandler.checkEntered(this.callMeBackForm, inputName);
      };


      $scope.clearForm = function () {
        $scope.callForm.Field3 = '';
        $scope.callForm.Field1 = '';
      };

    }]);

angular.module('naktbApp.partials')
  .controller('FooterMenuController', ['$scope', '$rootScope', '$route', '$routeParams', function($scope, $rootScope, $route, $routeParams) {
      $scope.menuItems = [
        {
          url: 'return_policy.html',
          title: 'سياسة الإسترجاع',
          slug: 'returnPolicy'
        },
        {
          url: 'terms.html',
          title: 'الشروط والاحكام',
          slug: 'terms'
        }
      ];


    }]);

angular.module('naktbApp.partials')
  .controller('TopMenuController', ['$scope', '$rootScope', '$route', '$routeParams', function($scope, $rootScope, $route, $routeParams) {
      $scope.menuItems = [
        {
          url: 'who.html',
          title: 'من نحن',
          slug: 'whoWeAre'
        },
        {
          url: 'service.html',
          title: 'خدماتنا',
          slug: 'service'
        },
        {
          url: 'price.html',
          title: 'الأسعار',
          slug: 'price'
        },
        {
          url: 'contact.html',
          title: 'اطلب',
          slug: 'contact'
        }
      ];

      //console.log($rootScope);


    }]);

angular.module('naktbApp.partials')
    .controller('OrderFormController', ['$scope', '$route', 'formHandler', function($scope, $route, formHandler) {

      $scope.formConfig = ifConfig.orderForm;
      $scope.spinner = false;
      $scope.phonePat = /^[0-9]+$/;
      $scope.formName = ifConfig.orderForm.id;
      $scope.orderForm = {};
      $scope.orderForm.idstamp = ifConfig.orderForm.idStamp;
      $scope.orderForm.comment = '';
      //$scope.orderForm[ifConfig.orderForm.sources.name] = ifConfig.orderForm.sources.default;

      angular.forEach($scope.formConfig.controls, function(item){
        console.log(item);
        $scope.orderForm[item.name] = item.default;
      });


      $scope.noResend = false;

      function formSentCb(status) {
        formHandler.formMessage($scope, status);
      }

      $scope.closeMessageBox = function() {
        $scope.formMessage = null;
      };


      $scope.checkForm = function () {
        $scope.spinner = true;
        if (!$scope.noResend) {
          formHandler.sendForm({name:$scope.formName, data: $scope.callForm}, formSentCb);
        }

      };

      $scope.checkDefaults = function (inputName) {
        formHandler.checkDefault(this.callMeBackForm, inputName);
      };

      $scope.checkEntered = function (inputName) {
        formHandler.checkEntered(this.callMeBackForm, inputName);
      };


      $scope.clearForm = function () {
        $scope.callForm.Field3 = '';
        $scope.callForm.Field1 = '';
      };


      $scope.changeNumber = function(model, count) {
        var currentValue = $scope.orderForm[model],
            countValue = currentValue + count;
        debugger;
        $scope.orderForm[model] = countValue < 0 ? 0 : countValue;
      };

    }]);
